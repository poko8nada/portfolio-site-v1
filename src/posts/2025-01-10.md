---
title: GA4＋GTMでアクセスフィルタを実装しようblog-format
createdAt: 2025-01-10
updatedAt: 2025-01-10
version : 1
thumbnail: /images/posts/pc01.svg
isPublished: false
---
## はじめに
ポートフォリオサイトを新しく立ち上げたので、[GA4(グーグルアナリティクス)](https://developers.google.com/analytics/devguides/collection/ga4)と[GTM(グーグルタグマネージャー)](https://developers.google.com/tag-manager/)を導入しました。

導入そのものはとても簡単だったのですが、 **特定のアクセスを除外するフィルタ設定**で少しつまずいたので、記事として残します。

## なぜGTM経由で実装するのか
### 特定のアクセスを「ホスト名」でフィルタしたい
GA4単体では、「IPアドレス指定」による内部トラフィックの除外はあるようですが、「ホスト名」を指定してすることはできないようです。
```Link
[GA4] 内部トラフィックの除外 - アナリティクス ヘルプ
support.google.com
https://support.google.com/analytics/answer/10104470?hl=ja
```
データを正しく計測するためならば、IP除外で事足りるような気もします。  
ですが、

- 本番環境での発火（GA4の計測）を自前のPC環境で確認したい
- 開発環境（localhost）では発火してほしくない
- デプロイ先のcloudflareのプレビューURLでは発火してほしくない

を同時に達成したいとなるとちょっと面倒な仕様に感じます。  
これを達成するためのGA4＋GTMです。

### 後々を見越して…
今後GA4以外のタグを埋め込む可能性を見越して、あらかじめGTMでタグを管理するのは大きなメリットです。

また、GA4単体での実装と労力的にも大差ないので、やっておくに越したことはありません。

## 実装方法
### 実装の流れ

1. GA4のアカウント取得とプロパティ作成
2. GTMのアカウント取得とコンテナ作成
3. GA4とGTMの連携
4. **GTMでのアクセスフィルタ設定←これが本記事の主題**
5. サイトにGTMを埋め込む

実際の流れは上記のとおりです。

1〜3はgoogleのサイト上での設定です。また本記事は4が主題なので後述します。

5については私の場合、ポートフォリオサイトがNext.jsですので（[詳しいサイト構成](/posts/2024-12-19)）、ググって情報を探しました。

下記の記事が参考になりました。4を除く一連の設定が詳しく説明されています。ありがとうございました。
```Link
【Next.js】Google Tag Manager 経由で Analytics を導入する [Techblog#27] | Folklore
www.folklore.place
https://www.folklore.place/techblog/2024/09/10
https://asset.folklore.place/ogp/techblog/2024/09/10/thumbnail.webp
```

### GTMでのアクセスフィルタ設定


